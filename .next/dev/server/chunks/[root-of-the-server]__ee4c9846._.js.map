{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 18, "column": 0}, "map": {"version":3,"sources":["file:///D:/Projects/Personal%20Expense%20Analyzer/src/lib/db.js"],"sourcesContent":["import { Pool } from 'pg';\r\n\r\nlet pool;\r\n\r\nconst config = process.env.DATABASE_URL\r\n    ? {\r\n        connectionString: process.env.DATABASE_URL,\r\n        ssl: {\r\n            rejectUnauthorized: false, // For some cloud providers\r\n        },\r\n    }\r\n    : {\r\n        user: process.env.DB_USER || 'postgres',\r\n        host: process.env.DB_HOST || 'localhost',\r\n        database: process.env.DB_NAME || 'expense_tracker',\r\n        password: process.env.DB_PASSWORD || 'password',\r\n        port: process.env.DB_PORT || 5432,\r\n    };\r\n\r\nif (process.env.NODE_ENV === 'production') {\r\n  pool = new Pool(config);\r\n} else {\r\n  // In development mode, stick the pool in a global variable\r\n  // so we don't restart it every time the module reloads.\r\n  if (!global.pool) {\r\n    console.log('[DB] Initializing new pool (dev)');\r\n    global.pool = new Pool(config);\r\n  }\r\n  pool = global.pool;\r\n}\r\n\r\nexport default pool;\r\n"],"names":[],"mappings":";;;;AAAA;;;;;;AAEA,IAAI;AAEJ,MAAM,SAAS,QAAQ,GAAG,CAAC,YAAY,GACjC;IACE,kBAAkB,QAAQ,GAAG,CAAC,YAAY;IAC1C,KAAK;QACD,oBAAoB;IACxB;AACJ,IACE;IACE,MAAM,QAAQ,GAAG,CAAC,OAAO,IAAI;IAC7B,MAAM,QAAQ,GAAG,CAAC,OAAO,IAAI;IAC7B,UAAU,QAAQ,GAAG,CAAC,OAAO,IAAI;IACjC,UAAU,QAAQ,GAAG,CAAC,WAAW,IAAI;IACrC,MAAM,QAAQ,GAAG,CAAC,OAAO,IAAI;AACjC;AAEJ;;KAEO;IACL,2DAA2D;IAC3D,wDAAwD;IACxD,IAAI,CAAC,yDAAO,IAAI,EAAE;QAChB,QAAQ,GAAG,CAAC;QACZ,yDAAO,IAAI,GAAG,IAAI,qJAAI,CAAC;IACzB;IACA,OAAO,yDAAO,IAAI;AACpB;uCAEe"}},
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///D:/Projects/Personal%20Expense%20Analyzer/src/lib/authorize.js"],"sourcesContent":["import jwt from 'jsonwebtoken';\r\n\r\nexport function withAuth(handler) {\r\n    return async (req, res) => {\r\n        console.log(`[Auth Check] Verifying token for: ${req.method} ${req.url}`);\r\n\r\n        const token = req.headers.authorization;\r\n        if (!token) {\r\n            console.log('[Auth Check] Failed: No token provided');\r\n            return res.status(401).json({ error: 'Access Denied: No Token Provided' });\r\n        }\r\n\r\n        try {\r\n            const tokenString = token.split(' ')[1];\r\n            if (!tokenString) throw new Error('Malformed Token');\r\n\r\n            const verified = jwt.verify(tokenString, process.env.JWT_SECRET || 'secret_key_123');\r\n            req.user = verified;\r\n\r\n            return handler(req, res);\r\n        } catch (err) {\r\n            console.log('[Auth Check] Failed: Invalid token');\r\n            return res.status(400).json({ error: 'Invalid Token' });\r\n        }\r\n    };\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AAEO,SAAS,SAAS,OAAO;IAC5B,OAAO,OAAO,KAAK;QACf,QAAQ,GAAG,CAAC,CAAC,kCAAkC,EAAE,IAAI,MAAM,CAAC,CAAC,EAAE,IAAI,GAAG,EAAE;QAExE,MAAM,QAAQ,IAAI,OAAO,CAAC,aAAa;QACvC,IAAI,CAAC,OAAO;YACR,QAAQ,GAAG,CAAC;YACZ,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,OAAO;YAAmC;QAC5E;QAEA,IAAI;YACA,MAAM,cAAc,MAAM,KAAK,CAAC,IAAI,CAAC,EAAE;YACvC,IAAI,CAAC,aAAa,MAAM,IAAI,MAAM;YAElC,MAAM,WAAW,+KAAG,CAAC,MAAM,CAAC,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;YACnE,IAAI,IAAI,GAAG;YAEX,OAAO,QAAQ,KAAK;QACxB,EAAE,OAAO,KAAK;YACV,QAAQ,GAAG,CAAC;YACZ,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,OAAO;YAAgB;QACzD;IACJ;AACJ"}},
    {"offset": {"line": 94, "column": 0}, "map": {"version":3,"sources":["file:///D:/Projects/Personal%20Expense%20Analyzer/src/pages/api/budget/status.js"],"sourcesContent":["import pool from '../../../lib/db';\r\nimport { withAuth } from '../../../lib/authorize';\r\n\r\nasync function handler(req, res) {\r\n    if (req.method !== 'GET') {\r\n        return res.status(405).json({ message: 'Method not allowed' });\r\n    }\r\n\r\n    try {\r\n        const { month } = req.query;\r\n        const user_id = req.user.id;\r\n\r\n        if (!month) {\r\n            return res.status(400).json({ error: 'Month parameter is required' });\r\n        }\r\n\r\n        const dbMonth = month.length === 7 ? `${month}-01` : month;\r\n\r\n        const budgetRes = await pool.query(\r\n            'SELECT * FROM budgets WHERE user_id = $1 AND month = $2',\r\n            [user_id, dbMonth]\r\n        );\r\n\r\n        if (budgetRes.rows.length === 0) {\r\n            return res.json({ notSet: true });\r\n        }\r\n\r\n        const budget = budgetRes.rows[0];\r\n        const totalBudget = Number(budget.monthly_budget);\r\n\r\n        const startDate = new Date(dbMonth);\r\n        const endDate = new Date(startDate.getFullYear(), startDate.getMonth() + 1, 1);\r\n        const endDateStr = endDate.toISOString().split('T')[0];\r\n\r\n        const spentRes = await pool.query(\r\n            `SELECT SUM(amount) as total FROM transactions \r\n             WHERE user_id = $1 AND txn_date >= $2 AND txn_date < $3`,\r\n            [user_id, dbMonth, endDateStr]\r\n        );\r\n\r\n        const totalSpent = Number(spentRes.rows[0].total) || 0;\r\n        const remaining = totalBudget - totalSpent;\r\n\r\n        let alert = null;\r\n        let alertLevel = 'none';\r\n\r\n        if (totalSpent >= 0.9 * totalBudget) {\r\n            alert = \"⚠️ Budget almost exhausted! You have spent over 90%.\";\r\n            alertLevel = 'danger';\r\n        } else if (totalSpent >= 0.7 * totalBudget) {\r\n            alert = \"⚠️ You're crossing safe spending (70% used).\";\r\n            alertLevel = 'warning';\r\n        }\r\n\r\n        res.json({\r\n            monthly_budget: totalBudget,\r\n            savings_target: Number(budget.savings_target),\r\n            total_spent: totalSpent,\r\n            remaining: remaining,\r\n            alert,\r\n            alert_level: alertLevel\r\n        });\r\n\r\n    } catch (err) {\r\n        console.error(err.message);\r\n        res.status(500).json({ error: 'Server Error' });\r\n    }\r\n}\r\n\r\nexport default withAuth(handler);\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;;;;;AAEA,eAAe,QAAQ,GAAG,EAAE,GAAG;IAC3B,IAAI,IAAI,MAAM,KAAK,OAAO;QACtB,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,SAAS;QAAqB;IAChE;IAEA,IAAI;QACA,MAAM,EAAE,KAAK,EAAE,GAAG,IAAI,KAAK;QAC3B,MAAM,UAAU,IAAI,IAAI,CAAC,EAAE;QAE3B,IAAI,CAAC,OAAO;YACR,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;gBAAE,OAAO;YAA8B;QACvE;QAEA,MAAM,UAAU,MAAM,MAAM,KAAK,IAAI,GAAG,MAAM,GAAG,CAAC,GAAG;QAErD,MAAM,YAAY,MAAM,oHAAI,CAAC,KAAK,CAC9B,2DACA;YAAC;YAAS;SAAQ;QAGtB,IAAI,UAAU,IAAI,CAAC,MAAM,KAAK,GAAG;YAC7B,OAAO,IAAI,IAAI,CAAC;gBAAE,QAAQ;YAAK;QACnC;QAEA,MAAM,SAAS,UAAU,IAAI,CAAC,EAAE;QAChC,MAAM,cAAc,OAAO,OAAO,cAAc;QAEhD,MAAM,YAAY,IAAI,KAAK;QAC3B,MAAM,UAAU,IAAI,KAAK,UAAU,WAAW,IAAI,UAAU,QAAQ,KAAK,GAAG;QAC5E,MAAM,aAAa,QAAQ,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,EAAE;QAEtD,MAAM,WAAW,MAAM,oHAAI,CAAC,KAAK,CAC7B,CAAC;oEACuD,CAAC,EACzD;YAAC;YAAS;YAAS;SAAW;QAGlC,MAAM,aAAa,OAAO,SAAS,IAAI,CAAC,EAAE,CAAC,KAAK,KAAK;QACrD,MAAM,YAAY,cAAc;QAEhC,IAAI,QAAQ;QACZ,IAAI,aAAa;QAEjB,IAAI,cAAc,MAAM,aAAa;YACjC,QAAQ;YACR,aAAa;QACjB,OAAO,IAAI,cAAc,MAAM,aAAa;YACxC,QAAQ;YACR,aAAa;QACjB;QAEA,IAAI,IAAI,CAAC;YACL,gBAAgB;YAChB,gBAAgB,OAAO,OAAO,cAAc;YAC5C,aAAa;YACb,WAAW;YACX;YACA,aAAa;QACjB;IAEJ,EAAE,OAAO,KAAK;QACV,QAAQ,KAAK,CAAC,IAAI,OAAO;QACzB,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,OAAO;QAAe;IACjD;AACJ;uCAEe,IAAA,4HAAQ,EAAC"}}]
}